# -*- coding: utf-8 -*-
"""
Created on Mon Dec 19 09:17:51 2022

@author: adam.davitt
"""

my_in='>><<<>>>><<<><>>><><<<<>>>><>>>><<<<>><<<<>>>><<<<>>>><<<>>>><<<>><<<<>>><<<<><><<>>><>>>><<<>>><<><<<><<<>>><<>>><<<><<><<>><<>><<<>>>><<<<><<>>>><>><<<>><<>>><<<>>>><<<<>>><<>>><><<<>>><<>>>><>>><<<<>>>><<>><<<<><<<<>><<<<>>><<>>><<<<><>>>><<<><<<<>><>>><<<<><<>>><>><<><><<>>><<<>>><<<<><<>>><><<<>><><<<<>><><<<>><<<>><>><>><<><<<<>>>><<<<>>><><<<><<>>>><<><<>><<>><><<<>>><>><<<>><<<><<><><<>>><<>>>><<<<>>>><<><<>><<<><<>><<<<><>>><>><<>>>><<<<>>><<<>>><<<>>><>>><>>><<<<>>><<<<><<<<>>>><>><<><<>><<<><><>>>><>>>><<<><<<><<<><<>><<<>>><<<>>><<<>>>><<>>><<<>><<<>>><<<<><<<><<>><<<><<>>><<<<>><<<><<<>><<<>><<>>>><<>><>><<<><<<<>>>><><<>><<>>><<><<>>><<>>>><<>>><<><<<<>>><<<>>><><<<>><<><<<><>>>><<>>><<<<>>>><<>>><<<<><<<<>>><<<<>><<><<<<><<><<<><<<<><><<>>>><<>>>><>>><<>>>><<<<>><><<<>>>><<>>><<<>>>><<>><<>><<<<>>><<<>><<>><<<<>>><>>>><<<>>>><<<>><<<<>><<>>><<<>>><<>><<<><<<>>>><<>>><>><<>>>><<>>><>><>><<<<>><<<<>>>><<>><<<>><<<>>><<<>><<>>><<>>>><<>><<>><<><<<<><<<>>>><>><>><<<<>><>><<>>>><<<>><>>><<>><>><>>>><<<<>>><<<>>><>><<<<>>><<<<>>><><<<><<<><<<>>>><<<<><>>>><<><<<>>>><<>>>><>><>>><<<>>>><<<>>>><>>><<<<>>><<<><>>><>>>><<<>><><<<<>>><<<<>><<<><<<<><<<>>><<<<>>><<<<>><<<><>>><<<><<>><<<<>><<<<>>><<>>><<<>>><<<<>>><>><<<>>>><<<<>><<<>><>>><<<>>>><>>>><<><<<>>>><>>>><<<<>>><<<<><<<><<<>>>><<<>><<<<>>>><<<<>>>><<<<><<<>><>>><><<<<>><<<<>>>><<>><<>><<>><<<>>>><<>><<<<><<<<>><>><<<<>>><<<>>><<<>>><<<<><<>><<<<><<>>><<<>>><<<>><><>><<>><<<<>>><<<<>>>><<<>><>>>><<<<><>>>><>>><<<<>><<>>>><<<<>>><<<>>>><>>><<<><<><<<>><>>>><<<>><<<<>>><>>><<<>><>><<<>>>><<<<>>>><<>><<<>>><<<<>>><<<<><>><<<>><<<>><<<>>><>>><<<>><<<<>>><<<<>>><<<<>>><<<<>><<<<>><<<<>>><<<<>>>><<<>><<<>>><<>>>><<>><<<>>>><<<>><<>>>><<<>><<<<>>><<<<><<>>><>><>>>><<>>>><<<<><<<><<><<<><<<<>><><<<><<<>><<<><<>><<<<>>><<<>><<>>>><><<<><><>><>><<<<>><<><>><<<>>><<<>>>><<<><<<>><<>><<>>>><<<<><<>><>><<<>>>><<><<<>>><>>>><<<<>>>><<>>><<>>><<<>>>><<<>>>><<>><<<>>>><<<<>><<<>><<<<>><>><<>><<<>><<<>><<>>>><<<>><<<>><<<<>><<<<>><<<<>>><<<><<<><<<<>>>><<><<<<><<>><>>><<<<>>><<<<><<<<><<<>>><<<><<<>>>><>>><<>>>><>><><<><<<<>>><<<>>><>><<><<<>><<<<>>>><<>>><<<<>><<<><<<>>><<>>><>>>><<>>><<<<>><><<>><<><<>>>><<><<<<>>><<<>>>><>>><<>>><<>>><<>><<<><<<<>><>>>><>>><<<><<<<>>>><<<<>>><>>>><<<<>>><<<><>><><<<<>>><<>>>><<>>><<<>><<>>>><<<>>>><<>>><<>>>><>>><<<<>>>><<<<>>><><<<<>>>><><<<<>><<>>>><<><<>>>><<<><><>>>><><<<<>><<<<>>><<>><>><<<><<<<>>>><<<>>><<<<><<>>>><<<>>>><<<<>>><<<><<<>><<<>>>><<<<>><>>>><<<>><<<>><>>>><<>>>><><<<>>><<<>>>><><<>>><<<><<<><>>>><<>>><<<>>>><><>><><>>>><><<<<><<>><<<>>><>>><<<<>>>><<<<>>>><<<<>>><<><><<>>><<<<>><>>>><<>>><<<>>><<<<>>><<<<>><>><<<<>>>><<>><<>><<<<>><<<<>>>><>>><<<>>>><<<>><<<<>>>><>>>><<>><>>>><>>><<>>>><<<>>>><<<<>><<<<>>>><<<><<<<>>><>>><<<<>><<<<>><>>><>><<<<><<<>><<<><<>><>>>><<<<>><><<<><>>><<<><<>><<<<>>>><<><<<>>><<>><<<><<><<<<>>><<<<><<<><<<>>><>><<<><<<>>>><>>>><<<>>>><<<<>>>><<<>>><><<>>>><<>>>><><<>>><>>>><<<>>><>>>><<<><<<<>><<<>>><<><<><>>>><<<>>><><<<>>><>><>>><<<<>>><<><<<<>>><<<<>>><<>><<>>><<<><<<<>>><<><<<>>>><<<<>>><<<>><>>><<<>><<<>>><>>>><<>><<<<><<>>>><<>>>><<<><<>>>><><>><>>><>><<>><<<<><<><<>>>><>><<<>>><>>><>>>><<<>>>><<<>><<<>><<>><><<<<><<<<>>>><<>>>><<>><<<>><<>><<<<><<<>><>>>><<>>><<<<>><>>><<<<>><<<<>>><<<<><<<>><<<>>>><<<>>><<<>>>><<<<><<<<>>>><<>><<>>><<<><<<>>>><<>>><>><<>>>><<<>>>><<>>>><>>><>>><<>><<<<><<<<>><<<<>>><<<<>><>><<<>><>>>><><<<<>>>><>><<<>>>><<<><<>>><<><><<<>>><>><<><>>><<<<><<>><<<>><<<>>><<>>><<<>>><<<><<>><>>>><>><<<<>><><>>><>>>><>>><<<>>><<>><<<><>>><>>><<>>>><<<><<<<>>><<<<><<>><<<>>>><<<>>><<<><>>>><><<><<<<>>><<<<>><<<<>><<>>><<>>>><>>>><<<><<<><>>>><>><<>>><<>>>><<<<><>><><<<><<<>>><<<<>><<<><<<><>>><<<>>><>>><<<<>>><><>>>><<<<><<<<>>><<>>><<>>>><<<<>>>><>>><><<>>>><><<<>>><<<>>>><>><<>>><<<>>>><>>>><<<<>>>><>><<<>>>><>><>>>><<><>>><<>>><>>>><<<>>>><<<<><<<<>>><<<<>>>><><>><<><<><<<<>>>><<><<>><<>><<<>><<<<>>>><><><<>><>>>><>>><<>>><<>><<<<>><<>><<<<>>>><>>>><<>>>><<<>>>><<<<>>>><<>>><><<<<>>><<>><>>><<>>>><<<<>>><<<<>>><<>>><<><<<<>>><>>>><<<>>>><<<<><>>>><<<<>><<<<>>>><<>><<<>><<<<>>><<<<>><<<>><>>><<<>>>><>>>><<<><<<>>>><<<>>><<<<><<>>><<<>>><<>><><<<<>>>><<><<<>>><<<>>><<<>>><<<<>><<<<>><<<<>>>><<<><>><<><<<<>>>><<<<>><<<>>>><><<<>>><<<><>>>><<>>>><<<<>>>><<<<>>><<>><<<>>><<><<>>><<<>>>><<<<><<<<>>>><<<>>>><<<>>>><<><<<>>><<<>>><>><<>>><<<><<<>>>><<<>>>><<>>>><<<<>>>><<>>><>>><<<<>>><<<<><<<>>><<<><<<<>>>><><<>>><>>>><<>>>><<<>>><>><<<>>><<<>>><<>>>><<<<><<>><<>>>><<<<>><<>>>><>><<<<>>>><<><<<><>>>><<<<><<<>><<>>>><>><<>><<<<>>>><<<<>><<>>>><<>>><><<<<>><><<<<><<<<>>>><><>><<<<>><<<>>><>><<<><<<>><<<<>>>><>>><<<<>>><<<<><<>>><<<<>>><<<<><<<<>>>><>>>><<<>>>><>>><<>>>><<<<>><<><<<>>><<<>>>><<><<<<>>><>><<>>>><<<<>><><>><<><>><>>><<><<<>><<<<><>>><<<<>>><>>><>>>><>>><<>>>><<<<>>>><<<<>><>><<<<><<<<><<<<>><<<>>>><<<><<<>><>>><>>><<>>><<<<><<><<>>><<<>><<<>>><><<>>>><<<<>>><<<>>>><<>><<<>>>><<<<>>><<<<>>><>>><<<>>><<>><<<>>>><>>>><<>>><>><>><<>><<>>><<<<>>>><><><<>>>><<<>>>><<><<<>>>><>><>>><>>><<>><>>>><>><<>>><<<<>>><<<>>><<<>>>><<><<<>><><<>><>>>><<>>>><<<<>>>><>><><<<<>><<>>>><>><><>>><<<>>><>>>><>><<<<>><>><>><<<>>><><<>><>><<>><<<<>>>><><<>>><<<>>>><><<<><<<<>>>><>>><<>>><<<><<<<>><<<>>>><<<>>><<<>><>><<<<><<<<><<<>>>><<<>>><<><<<>>><<<<>>>><<<>>><><<<>><<<><<>>>><><>>><<<><<<>><<>>>><<<>><<<<><<><<<<>>><<>>><<<<>>>><<<>>>><<<<>>><<<<>><>><<>>><<><<<>>>><<<>><<<<><<>>>><<<<>><<<<>><<>>>><><<<<>><<<<>>><<<<>>>><<>>>><>>>><<>><<>>><<<>><<><<<>>>><<>>>><<<>><<<><<>><<><<<>><<<<><<>>>><>>><<>>>><<<><<>>>><<<>>>><<<>><<<<>>>><<<<>><<<<>><>>><>>>><<>>>><<><<>>><<<<><<>>>><>><<>><>>>><<<<>>><<<<>><<<<>>>><<<<><<<<><<><<><><<>>>><>><>>><<<<>><<>>><>>>><><<<><<>><<<>>>><<<<>><<<<><<>><<<><<>><<<>>><>><<<>><<>>>><<>><><><<<>>>><<<><<<>>>><>><<<>>><<<>>>><<>>>><<<<>>>><>><<<>><<<>>>><<<<>>>><>><<<<><<<>>><<<<>>><<>>><>>>><><>>>><<>>><<<>>>><>><<<<>>>><<>>><<><<><<<<>>>><<<><<<<>>>><<>>>><<<><<>>>><<<<>>>><<<<>>>><<<>>><<<<>>><<<><<<><<<>><<>><>>><<><<><<<<>><<<<>>>><<<<><<>>>><<<>><<<>>><<<>>><<<<><<<<>>><<<<>><<<>><>>><<>>><<<<>>><><<><<<>>><>><>>><<<>>>><<<>>><<<<>>>><<<>>><<<><<<><<<>>>><>>>><<<<>>><<>>><<>>>><<<><<<>>><<<>>>><<<<><<<<>>><<>><>>>><<<<><>><>><<>>><<><<<>>>><<<<>><<<<>><<>>>><<<<>>><<<<><>><<<>>>><<<<>>>><<<>>><<>>><<>>><><>>><><<<<><<<<>><<><><<><<<<>><<<>>>><<>>><<<<>><<<>>><<<<>>>><<<<>>>><<<>><<<><<>>><>>><<<<>><<>>><>><<<<>>><<<<>>>><<>><>>>><<<<>>><>><>><<<>>>><<<>>><<<>><<<<>>>><<<>>><<<>>>><<>><>>><<<<>>><<>><<<><<<>><<<>><<<>><<<<>><<<><<>>><><<<>>>><<<<>>><>>><<>>>><<<><<>>><>>>><><<>><<>><<<<>><<<<>>><<<>>>><>>>><<<><><<<<>><<>>>><<<<>>>><<<>>><<<<>>>><<<>>><<>>><<>>>><<>>><>>>><<<>><<<><>><<<><<><>>><>>>><<<>>><<>>>><<>><>><>>>><<<<>><<>>>><<><<>>><>><<<<><<><<<>>>><<<<>>><>>>><<<>>><<<<><<<>>>><<>>>><<<<>>>><<><<<<><><<>>><<<<>><>><<<>><<><>><<>>>><<<<><<<><<<>>><<<><<>>><<>>>><><<>>>><<>><>>>><<<<>>>><>><<><<<<>>>><<<<>>><<<>><<<>>><<>>><<<<><>>><<><>><<<<><>>>><<<>>><<<<><<><>><<<>>>><<><><><<>><<>>>><<<<>>><<<>>>><<<>><>>>><>>>><<<<>>>><<<<>>>><<<<>>>><<<<>>>><>>>><<>>>><<<>>><<<<>><<<>><<><<>><>>>><<<><<<>>>><<<>>><<<>>>><<<>>>><<<>>>><<<<>><<<<>>><<<>>>><<><<<<><<<<>>>><<<<>><<<<>>>><<<>>><<<<>><<<<>>>><><<<<><<<<><>><<<>><<<><<>><<><<<>><<>><<>>>><<>>><>>><<<<>>><<<<>><<<<>>>><<<>>>><>><>>>><>>>><<>>><<<>><<>>><<<<><<<<>>><<<>>>><<><<>><<<<>><<<><<<>>><><<<<>><<<<>><<<>>>><>>>><<>>><<<<>>><<<<>>><<>>>><<<>>><<<<>>>><<<<>>><<<><><<<>>>><<<>><>>>><<<<>><<><<><<<><<<><>><<>>>><<<><<<<>><>>>><<>>>><>>><<<<>>><<<<>><<>>><<<>>><<<<>><<<<>>>><<<><>>><<<<>><>><<<><<<>>>><>>><<<<>>><<<>><>><>><<<>>>><<>>>><<<><<>>><<<<>>>><<>>><<<>><<<<>>><<>>><<<<><<<<>>>><<>>>><<<<>>>><<<<>>>><<><<<>><<<<>><<<>><<<>><<<<>>><>>><<<><>>>><<<<>>>><<>>>><<<>><<<<><><<<<>>><<<<>>>><<>>><<>>><<<>><<<<>>>><<<<>>>><>><>><<<<>>>><<<>>>><<><<<><<>><<<<>><<<>><<<<>><>>>><<<<>>>><<<<>>>><<<>>>><<<<>>><<>>>><<>>>><><<<>><<<>>><<<><<>>><><<<><>>>><<<<>>><>><>><<>>>><<<<>>>><<<<>>><>><<<<><<>>><>>>><<>><<>>>><<>>><<<<>>><<<>>><>><<<>><<<>>>><<<>><<<>><<>>><>><<<<>>><<<<>><<<><<<>><<<<>>>><<><<<>>><<<<>>><<><<><>>>><<<>>><<<>>>><<<>><<<>><<<<>><<<<>>><<<<>>>><<<>>><<<>><<<<>><<<>>>><><<><<><>><<<>>><<>>><<<<>>>><<<<>>><<<><<>><<<><<<<>><<<<>>><<<<><>>><<<>><<><><<<>>>><<<<><<<>>><<<>>>><<<<>>>><<<>><<<<>>>><<<><<<<>><<>>>><<<>><<>>>><<><<<>>>><><>><<<<>>><><<<>>>><<<><<><<>>><<<<>>><<<>><>><<<><<<>><<<<><<<<>><<<<><<<<>><><><<<><>>><>>><>>>><<<<>>>><<<>>><><>>>><<<<>>><<<>>><<<<>><<<>><<<><<><<><<>>>><><<<>><<><>>><<<<>>><<<<>>><<><<<<>><<<<><<<><<<>>>><<<>><<<>><<<<>><<<<><<<>>>><<<<><<<<>><<<<><<<<>>><<<<>>><>>><<<<>><<>>>><<<>>>><<<<>>><<>><<<<>><>>><>>>><<><<>>>><<>><>>>><>>><>><<>>>><<<<>>>><<<<><<<<><<<>>><<<>><<<<>>><><<<<>><<<<>><><<<<>>><<<<><<><<><<>><<<><>>>><<<<>><>><<>>>><<<>>>><>><>><<>>>><>><><<<>><><>>><<>>><<>><>>><>>>><<<<>><<>>><<>>><>><<<>>>><<<>><<<>>>><<<<>><<<<>>><<<>>>><<<<>>><>>><><<<<>>><>><<<>><<<<><<><<<>><<>>><<><<<<>>><<<>>><<<><>><><<<<>>>><<<><<><>><<>>>><<<>>><<<>>><<<><>><><<>>><<><<>>><><<>>>><>>><<<<>>><<>>><<<<><>><<<><><<<<><<>>><<>>>><<<>>><<<>><<>>>><<<><<<>><<>>>><<>>><<<<>>><<<>>>><<>>>><<<<><<>><<>><<><>>><<><<<<>><<>><<<>><<<<><><<<<>>><>><<<<>>>><<<>>>><<<<>><>>>><>>>><<<<><<>>><<<<>><<<<>><<<>><<<>><><<<<><<><<<><>>>><<<<>>>><>><><>><<<<><<>>>><<><>><<>>><<<<>>>><<<<>>>><>>>><<>>><<<>>>><<>>><<<>>>><<<<>><<<><>>>><<>><<>>><><<>><<<>>>><><<>>>><<<>><<<<>>><><>>><<<><<>>><<<<>><<<>><>><<<>>><<<<>><<<<><<<<>>><<<<>>>><><<<<>><<<<>><<<><<>><<><<<>><<<>><<>>>><>><>><<>>><<><<>>>><>>><<><<<><<>><<>><<><>>>><<>>><<><<<>>>><<<<><<>>>><<><<><<<>>><<><<<>><<<<>><<<<><<>><<<>>><<>>><<<<>>><<>><<<>>>><<<<>>>><>>>><<<<>><<>><<<<>>><<><<<>>>><<<>><<<<>><<<>>>><>><<>>>><<<<>>><<<<>>>><>>>><<<<>><>>>><<<<><<<<>>><<>>><<<<>><<>>>><><<>><<>>><<<>><<<<>><>>><>>>><>>><<<<><>>>><<<>><>>><<<<>><<<>>><<<><<<>>><<<<>>>><<<>>>><>>><<>><<>><<>>><<<<>>>><<<<>>><<<>><<><<<>><>><<<>>>><<<>><<<>><<<>>>><<<><>><<<>>>><<>>>><<>>><<<>>><>>>><<<<><<<<>>>><<>><<<<><<<<>>><<>><<<>><>>><>>>><<<<>>>><<<>><<>>><>>>><<>><<>>><<><<><<>>><<>><<<>>>><<>>>><<<<>>>'


my_env = []

def Reset_env(my_env):
    i=0
    f=0
    while f==0 and i<len(my_env)-1:
        if my_env[i]==['.','.','.','.','.','.','.']:
            i+=1
        else:
            f=1
    my_env = [['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.']] + my_env[i:]
    return my_env

def Rindex(lis,char):
    for x in range(len(lis)-1,-1,-1):
        if lis[x]==char:
            return x

in_ind=0

for r in range(2022):
    print(r)
    my_env=Reset_env(my_env)
    if r%5==0:
        my_env[3]=['.','.','@','@','@','@','.']
        h=1
    elif r%5==1:
        my_env[1]=['.','.','.','@','.','.','.']
        my_env[2]=['.','.','@','@','@','.','.']
        my_env[3]=['.','.','.','@','.','.','.']
        h=3
    elif r%5==2:
        my_env[1]=['.','.','.','.','@','.','.']
        my_env[2]=['.','.','.','.','@','.','.']
        my_env[3]=['.','.','@','@','@','.','.']
        h=3
    elif r%5==3:
        my_env[0]=['.','.','@','.','.','.','.']
        my_env[1]=['.','.','@','.','.','.','.']
        my_env[2]=['.','.','@','.','.','.','.']
        my_env[3]=['.','.','@','.','.','.','.']
        h=4
    else:
        my_env[2]=['.','.','@','@','.','.','.']
        my_env[3]=['.','.','@','@','.','.','.']
        h=2
    depth=3
    
    rest=0
    while rest==0:
        if my_in[in_ind]=='<':
            s=0
            for j in range(depth-h+1,depth+1):
                lead=my_env[j].index('@')
                if lead==0 or my_env[j][lead-1]=='#':
                    s=1
            if s==0:
                for j in range(depth-h+1,depth+1):
                    old_row=my_env[j]
                    new_row=['.','.','.','.','.','.','.']
                    for x in range(len(old_row)):
                        if old_row[x]=='#':
                            new_row[x]='#'
                        elif old_row[x]=='@':
                            new_row[x-1]='@'
                    my_env[j]=new_row
        else:
            s=0
            for j in range(depth-h+1,depth+1):
                lead=Rindex(my_env[j],'@')
                if lead==6 or my_env[j][lead+1]=='#':
                    s=1
            if s==0:
                for j in range(depth-h+1,depth+1):
                    old_row=my_env[j]
                    new_row=['.','.','.','.','.','.','.']
                    for x in range(len(old_row)):
                        if old_row[x]=='#':
                            new_row[x]='#'
                        elif old_row[x]=='@':
                            new_row[x+1]='@'
                    my_env[j]=new_row
        in_ind=(in_ind+1) % len(my_in)
        for j in range(depth-h+1,depth+1):
            if j==len(my_env)-1:
                rest=1
            else:
                for x in range(7):
                    if my_env[j][x]=='@' and my_env[j+1][x]=='#':
                        rest=1
        if rest==1:
            for j in range(depth-h+1,depth+1):
                for x in range(7):
                    if my_env[j][x]=='@':
                        my_env[j][x]='#'
        else:
            for j in range(depth+1,depth-h,-1):
                my_row=my_env[j]
                for x in range(7):
                    if my_row[x]=='@':
                        my_row[x]='.'
                    if my_env[j-1][x]=='@':
                        my_row[x]='@'
            depth+=1
    
tot_ct=0
for a in my_env:
    if a!=['.','.','.','.','.','.','.']:
        tot_ct+=1
print(tot_ct)




"""       PART 2      """

chopped=0

def Reset_env_2(my_env,chop):
    i=0
    f=0
    while f==0 and i<len(my_env)-1:
        if my_env[i]==['.','.','.','.','.','.','.']:
            i+=1
        else:
            f=1
    my_env = [['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.'],['.','.','.','.','.','.','.']] + my_env[i:]
    return my_env

my_env=[]
in_ind=0
r=0
my_places={}
deep=[0,0,0,0,0,0,0]
while str(r%5)+':'+str(in_ind) + ':' + str(deep) not in my_places.keys():
    
    
    my_places[str(r%5)+':'+str(in_ind)+':'+str(deep)]=r
    print(r)
    my_env=Reset_env(my_env)
    if r%5==0:
        my_env[3]=['.','.','@','@','@','@','.']
        h=1
    elif r%5==1:
        my_env[1]=['.','.','.','@','.','.','.']
        my_env[2]=['.','.','@','@','@','.','.']
        my_env[3]=['.','.','.','@','.','.','.']
        h=3
    elif r%5==2:
        my_env[1]=['.','.','.','.','@','.','.']
        my_env[2]=['.','.','.','.','@','.','.']
        my_env[3]=['.','.','@','@','@','.','.']
        h=3
    elif r%5==3:
        my_env[0]=['.','.','@','.','.','.','.']
        my_env[1]=['.','.','@','.','.','.','.']
        my_env[2]=['.','.','@','.','.','.','.']
        my_env[3]=['.','.','@','.','.','.','.']
        h=4
    else:
        my_env[2]=['.','.','@','@','.','.','.']
        my_env[3]=['.','.','@','@','.','.','.']
        h=2
    depth=3
    
    rest=0
    while rest==0:
        if my_in[in_ind]=='<':
            s=0
            for j in range(depth-h+1,depth+1):
                lead=my_env[j].index('@')
                if lead==0 or my_env[j][lead-1]=='#':
                    s=1
            if s==0:
                for j in range(depth-h+1,depth+1):
                    old_row=my_env[j]
                    new_row=['.','.','.','.','.','.','.']
                    for x in range(len(old_row)):
                        if old_row[x]=='#':
                            new_row[x]='#'
                        elif old_row[x]=='@':
                            new_row[x-1]='@'
                    my_env[j]=new_row
        else:
            s=0
            for j in range(depth-h+1,depth+1):
                lead=Rindex(my_env[j],'@')
                if lead==6 or my_env[j][lead+1]=='#':
                    s=1
            if s==0:
                for j in range(depth-h+1,depth+1):
                    old_row=my_env[j]
                    new_row=['.','.','.','.','.','.','.']
                    for x in range(len(old_row)):
                        if old_row[x]=='#':
                            new_row[x]='#'
                        elif old_row[x]=='@':
                            new_row[x+1]='@'
                    my_env[j]=new_row
        in_ind=(in_ind+1) % len(my_in)
        for j in range(depth-h+1,depth+1):
            if j==len(my_env)-1:
                rest=1
            else:
                for x in range(7):
                    if my_env[j][x]=='@' and my_env[j+1][x]=='#':
                        rest=1
        if rest==1:
            for j in range(depth-h+1,depth+1):
                for x in range(7):
                    if my_env[j][x]=='@':
                        my_env[j][x]='#'
        else:
            for j in range(depth+1,depth-h,-1):
                my_row=my_env[j]
                for x in range(7):
                    if my_row[x]=='@':
                        my_row[x]='.'
                    if my_env[j-1][x]=='@':
                        my_row[x]='@'
            depth+=1
    r+=1
    deep=[0,0,0,0,0,0,0]
    for x in range(7):
        d=0
        c=0
        while d==0 and c<len(my_env):
            if my_env[c][x]=='#':
                deep[x]=c
                c=0
                d=1
            else:
                c+=1


# We have the exact same situation at r=2016 that we had at r=301

#How many rows do we have after 301 rocks have fallen - 476
#How many do we have after 3050 have fallen? - 2856

#Every cycle of 1715 rocks from here, we add 2574 lines

(1000000000000-301)//1715
# 583090378 Complete cycles


(1000000000000-301)%1715
# Remainder of 1429 rocks

#Split the problem into 3 parts, lines before rock cycle, lines during and lines after
#Before is 476

#During is 2574 * 583090378
2574 * 583090378
# 1500874632972

#After is the same as lines after 2016 + 1429 - lines after 2016 = 5189 - 3050 = 2140

476 + 1500874632972 + 2139

# Helpful functions below
    
my_env = []
in_ind=0

for r in range(3445):
    #print(r)
    my_env=Reset_env(my_env)
    if r%5==0:
        my_env[3]=['.','.','@','@','@','@','.']
        h=1
    elif r%5==1:
        my_env[1]=['.','.','.','@','.','.','.']
        my_env[2]=['.','.','@','@','@','.','.']
        my_env[3]=['.','.','.','@','.','.','.']
        h=3
    elif r%5==2:
        my_env[1]=['.','.','.','.','@','.','.']
        my_env[2]=['.','.','.','.','@','.','.']
        my_env[3]=['.','.','@','@','@','.','.']
        h=3
    elif r%5==3:
        my_env[0]=['.','.','@','.','.','.','.']
        my_env[1]=['.','.','@','.','.','.','.']
        my_env[2]=['.','.','@','.','.','.','.']
        my_env[3]=['.','.','@','.','.','.','.']
        h=4
    else:
        my_env[2]=['.','.','@','@','.','.','.']
        my_env[3]=['.','.','@','@','.','.','.']
        h=2
    depth=3
    
    rest=0
    while rest==0:
        if my_in[in_ind]=='<':
            s=0
            for j in range(depth-h+1,depth+1):
                lead=my_env[j].index('@')
                if lead==0 or my_env[j][lead-1]=='#':
                    s=1
            if s==0:
                for j in range(depth-h+1,depth+1):
                    old_row=my_env[j]
                    new_row=['.','.','.','.','.','.','.']
                    for x in range(len(old_row)):
                        if old_row[x]=='#':
                            new_row[x]='#'
                        elif old_row[x]=='@':
                            new_row[x-1]='@'
                    my_env[j]=new_row
        else:
            s=0
            for j in range(depth-h+1,depth+1):
                lead=Rindex(my_env[j],'@')
                if lead==6 or my_env[j][lead+1]=='#':
                    s=1
            if s==0:
                for j in range(depth-h+1,depth+1):
                    old_row=my_env[j]
                    new_row=['.','.','.','.','.','.','.']
                    for x in range(len(old_row)):
                        if old_row[x]=='#':
                            new_row[x]='#'
                        elif old_row[x]=='@':
                            new_row[x+1]='@'
                    my_env[j]=new_row
        in_ind=(in_ind+1) % len(my_in)
        for j in range(depth-h+1,depth+1):
            if j==len(my_env)-1:
                rest=1
            else:
                for x in range(7):
                    if my_env[j][x]=='@' and my_env[j+1][x]=='#':
                        rest=1
        if rest==1:
            for j in range(depth-h+1,depth+1):
                for x in range(7):
                    if my_env[j][x]=='@':
                        my_env[j][x]='#'
        else:
            for j in range(depth+1,depth-h,-1):
                my_row=my_env[j]
                for x in range(7):
                    if my_row[x]=='@':
                        my_row[x]='.'
                    if my_env[j-1][x]=='@':
                        my_row[x]='@'
            depth+=1
    
tot_ct=0
for a in my_env:
    if a!=['.','.','.','.','.','.','.']:
        tot_ct+=1
deep=[0,0,0,0,0,0,0]
for x in range(7):
    d=0
    c=0
    while d==0 and c<len(my_env):
        if my_env[c][x]=='#':
            deep[x]=c
            c=0
            d=1
        else:
            c+=1

print(tot_ct)
